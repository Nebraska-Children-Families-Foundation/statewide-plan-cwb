{% extends 'core/base.html' %}
{% block content %}
{% load static %}
{% load widget_tweaks %}

<h1 style="padding-bottom: 15px">Community Action Steps</h1>

<!-- Bootstrap Breadcrumbs with Popovers -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a style="color: #333333; text-decoration: none" href="#" tabindex="0" role="button" data-bs-toggle="popover" data-bs-trigger="focus" title="Goal {{ goal.goal_number }}" data-bs-content="{{ goal.goal_name }}">
                Goal {{ goal.goal_number }} <i class="bi bi-info-circle-fill" style="margin-left: 5px"></i>
            </a>
        </li>
        <li class="breadcrumb-item">
            <a style="color: #333333; text-decoration: none" href="#" tabindex="0" role="button" data-bs-toggle="popover" data-bs-trigger="focus" title="Objective {{ objective.objective_number }}" data-bs-content="{{ objective.objective_name }}">
                Objective {{ objective.objective_number }} <i class="bi bi-info-circle-fill" style="margin-left: 5px"></i>
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <a style="color: #333333; text-decoration: none" href="#" tabindex="0" role="button" data-bs-toggle="popover" data-bs-trigger="focus" title="Strategy {{ strategy.strategy_number }}" data-bs-content="{{ strategy.strategy_name }}">
                Strategy {{ strategy.strategy_number }} <i class="bi bi-info-circle-fill" style="margin-left: 5px"></i>
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Related Action Steps <i class="bi bi-chevron-compact-down" style="margin-left: 2px"></i></li>
    </ol>
</nav>

<!-- Dropdown for Filtering by Community Collaborative -->
<select class="form-select mb-4" id="collabFilter" onchange="filterCollab()">
    <option value="">Show All Community Collaboratives</option>
    {% for collab in collaboratives %}
    <option value="{{ collab.community_collab_short_name }}">{{ collab.community_collab_name }}</option>
    {% endfor %}
</select>

<!-- Accordion for Activities -->
<div class="accordion" id="activitiesAccordion">
    {% for activity in activities %}
    <div class="accordion-item" data-collab="{{ activity.related_collaborative.community_collab_short_name }}">
        <h2 class="accordion-header" id="heading{{ activity.activity_id }}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ activity.activity_id }}" aria-expanded="false" aria-controls="collapse{{ activity.activity_id }}">
                <strong>{{ activity.activity_number }}:</strong>&nbsp; {{ activity.activity_name }} &nbsp;&nbsp;<span class="badge bg-success">{{ activity.related_collaborative.community_collab_name }}</span>
            </button>
        </h2>
        <div id="collapse{{ activity.activity_id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ activity.activity_id }}" data-bs-parent="#activitiesAccordion">
            <div class="accordion-body">
                <div style="margin-bottom: 10px"><strong>Activity Number / ID:</strong> {{ activity.activity_number }}<br></div>
                <div style="margin-bottom: 10px"><strong>Details:</strong> {{ activity.activity_details }}<br></div>
                <div style="margin-bottom: 10px"><strong>Lead:</strong> {{ activity.activity_lead }}<br></div>
                <div style="margin-bottom: 10px"><strong>Status:</strong> {{ activity.activity_status }}<br></div>
                <strong>To be completed by:</strong> {{ activity.completedby_year }} {{ activity.completedby_quarter }}<br>
                {% if activity.community_creator == request.user %}
                    <p><a href="{% url 'edit_community_activity' activity.pk %}">Edit</a></p>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p>No activities available.</p>
    {% endfor %}
</div>

<script>
    function filterCollab() {
        var selectedCollab = document.getElementById('collabFilter').value;
        var accordionItems = document.querySelectorAll('#activitiesAccordion .accordion-item');

        accordionItems.forEach(function(item) {
            if (selectedCollab === '' || item.getAttribute('data-collab') === selectedCollab) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
        })
    });
</script>
{% endblock %}
